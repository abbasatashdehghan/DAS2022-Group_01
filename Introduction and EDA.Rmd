---
title: "Group_01_Analysis.Rmd"
author: "Group_01"
date: "3/14/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(moderndive)
library(skimr)
library(readr)
library(Stat2Data)
library(ggplot2)
library(GGally)
library(dplyr)
library(knitr)
library(gridExtra)
library(janitor) 
```
# Introduction {#sec:Intro}

Dataset comes from the FIES (Family Income and Expenditure Survey) recorded in the Philippines. The survey, which is undertaken every three years, is aimed at providing data on family income and expenditure. In this study, we are going to identify the most influential variables on the number of people living in a household using a Generalised Linear Model. Below you can see an overview of the data and variables
```{r, message=FALSE, warning=F}
data <- read.csv("dataset1.csv", stringsAsFactors = T) %>% 
  rename("Number_of_Family"=7,"Income" = 1, "FoodExpenditure" = 3,
         "Gender" = 4, "Age" = 5,"Type" = 6, "Area" = 8,"HouseAge" = 9,
         "bedrooms" = 10) %>% select(-2)
#Region column removed from the data
  
glimpse(data)
```

$FoodExpenditure$ is the annual expenditure by the household on food (in Philippine peso)  
$Gender$ is the head of the households sex  
$Age$ is the head of the households age (in years)  
$Type$ is the relationship between the group of people living in the house  
$Number_of_Family$ is the number of people living in the house  
$Area$ is the floor area of the house (in $m^2$)  
$HouseAge$ is the age of the building (in years)  
$bedrooms$ is the number of bedrooms in the house  
$Electricity$ indicates that if the house have electricity? (1=Yes, 0=No)  

## Recast variables
we add a new column called "Number_of_Family_new", reducing the level of "Number_of_Family" from 15 to 2 to be used for binomial model
```{r, message=FALSE, warning=FALSE, echo=TRUE}
data <- data %>% mutate(Number_of_Family_new = cut(Number_of_Family,
                                  breaks = c(-1,4,Inf),
                                  labels=c("<=4", ">4")))

```

# Exploratory Data Analysis {#sec:EDA}
The following tables and graphs are produced to provide statistical summaries and graphs to see the distribution variables and their relationship and identify any possible outliers.

```{r data_summary}
# summary(data)
data[,-c(3,5,11)] %>% skim() %>% 
  select(skim_variable,numeric.p0,
                       numeric.mean, numeric.sd, numeric.p50, numeric.p100) %>% 
  kable(caption = "\\label{tabel:summary} Summary Statistics", 
        col.names = c("Variable", "Min", "Mean",
                                       "SD", "Median", "Max"),
        align = rep("c", 6), digits = 1)
```

Referring to \ref{tabel:summary}, the difference between mean and median indicates the presence of outliers in the data. The following pair plots fuhrer support the presence of outliers. 


```{r pairplot1, fig.cap="\\label{fig:pairplot1} The pair plot (first five variables) shows the relationship between each of the two variables", message=FALSE, warning=FALSE}
data[,c(1:5,11)] %>% ggpairs(aes(color = Number_of_Family_new))

```

```{r pairplot2, fig.cap="\\label{fig:pairplot2} The pair plot (second five variables) shows the relationship between each of the two variables", message=FALSE, warning=FALSE}
data[,c(6:11)] %>% ggpairs(aes(color = Number_of_Family_new))

```

Figure \ref{fig:outliers} presents the distribution of outcome variables with regards to each of the continuous variables. The boxplots can help us identify the outliers 

```{r outliers, fig.cap="\\label{fig:outliers} The boxplot of the outcome variables vs each of the continuous explanatory variables", message=FALSE, warning=FALSE}
# Defining a fucntion to draw multiple boxplots for the outcome variables
graph_function <- function(x){
  ggplot(data = data, aes(x = Number_of_Family_new, y = get(x))) + 
    geom_boxplot(aes(color = Number_of_Family_new)) + 
    theme(legend.position = "none") + labs(y = x) + 
    scale_y_continuous(limits = c(min(data[[x]])*0.9, max(data[[x]])*1.1)) + 
    stat_summary(fun.y = mean, geom = "errorbar", aes(ymax = ..y.., ymin = ..y..),
                 width = .75, linetype = "dashed")
}  
#Boxplots of outcome variable vs other continous variables:
graphs <- lapply(names(data)[c(1,2,4,6,7,8,9)], graph_function)

grid.arrange(graphs[[1]],graphs[[2]],graphs[[3]],graphs[[4]],
                  graphs[[5]],graphs[[6]], ncol = 2)

```

Once the outliers are spotted and removed, the skewness in data is decreased as it can be seen in the Figure \ref{fig:outliersremoved}

```{r outliersremoved, fig.cap="\\label{fig:outliersremoved} The boxplot of the outcome variables vs each of the continuous explanatory variables after removing outliers", message=FALSE, warning=FALSE}

#Removing outliers 
data <- data %>% filter(Income < 833000 & Area < 250)

graphs_updated <- lapply(names(data)[c(1,2,4,6,7,8,9)], graph_function)

p <- grid.arrange(graphs_updated[[1]],graphs_updated[[2]],graphs_updated[[3]],
                  graphs_updated[[4]],graphs_updated[[5]],graphs_updated[[6]],
                  ncol = 2)


```
The table \ref{tabel:summary_outlier_removed} shows the summary statistics after removing outliers. The difference between medians and means are now narrower. 

```{r data_summary_outliers_removed}
data[,-c(3,5,11)] %>% skim() %>% 
  select(skim_variable,numeric.p0,
                       numeric.mean, numeric.sd, numeric.p50, numeric.p100) %>% 
  kable(caption = "\\label{tabel:summary_outlier_removed} Summary Statistics after outliers removed", 
        col.names = c("Variable", "Min", "Mean",
                                       "SD", "Median", "Max"),
        align = rep("c", 6), digits = 1)
```

The following data and graphs display the relationship between categorical variables and outcome variable

```{r categorical_statistics}
data %>% select(Number_of_Family_new, Gender) %>% 
tabyl(Number_of_Family_new, Gender) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% kable(caption = "\\label{tabel:summary_Gender} Summary outcome variabels based on gender", align = rep("c", 3), digits = 1)

data %>% select(Number_of_Family_new, Type) %>% 
tabyl(Number_of_Family_new, Type) %>% 
  adorn_percentages() %>% 
  adorn_pct_formatting() %>% 
  adorn_ns() %>% kable(caption = "\\label{tabel:summary_Gender} Summary outcome variabels based on family type", align = rep("c", 3), digits = 1)

```
Table \ref{tabel:summary_Gender} shows that the men outnumber women as the head of household by almost 47 to 1. Furthermore, it can bee seen that the majority of families with in both groups are led by men.

```{r categorical_statistics_figs, fig.cap="\\label{fig:categorical_statistics_figs} The proportion of the outcome variables with regards to cetegorial variables"}
ggplot(data, aes(x= Gender,  y = ..prop.., group=Number_of_Family_new, fill=Number_of_Family_new)) + 
    geom_bar(position="dodge", stat="count") +
    labs(y = "Proportion", title = "The proportion of genders in each of the two categories")

ggplot(data, aes(x= Type,  y = ..prop.., group=Number_of_Family_new, fill=Number_of_Family_new)) + 
    geom_bar(position="dodge", stat="count") +
    labs(y = "Proportion", title = "The proportion of family type in each of the two categories") + theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
